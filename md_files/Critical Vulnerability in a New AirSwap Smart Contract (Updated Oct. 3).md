[](/)

[Get unlimited access](/plans?source=upgrade_membership---
nav_full----------------------------------)

[Open in
app](https://rsci.app.link/?$canonical_url=https%3A%2F%2Fmedium.com/p/c1204e04d7d3&~feature=LoOpenInAppButton&~channel=ShowPostUnderCollection&~stage=mobileNavBar)

[](/)

[Home](/)

[Notifications](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fme%2Fnotifications&source=--------------------------notifications_sidenav-----------)[Lists](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fme%2Flists&source=--------------------------lists_sidenav-----------)[Stories](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fme%2Fstories%2Fdrafts&source=--------------------------stories_sidenav-----------)

* * *

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-
story&source=--------------------------new_post_sidenav-----------)

[![Fluidity](https://miro.medium.com/fit/c/64/64/1*5pEAonqQtkWjGPLSudRP7g.png)](https://medium.com/fluidity?source=post_page
-----c1204e04d7d3--------------------------------)

Published in

[Fluidity

](https://medium.com/fluidity?source=post_page-----
c1204e04d7d3--------------------------------)

[![AirSwap](https://miro.medium.com/fit/c/96/96/1*S-j0-sWqnj2pMlbQUFV4iQ.jpeg)](/@airswap?source=post_page
-----c1204e04d7d3--------------------------------)

[AirSwap](/@airswap?source=post_page-----
c1204e04d7d3--------------------------------)

Follow

Sep 13, 2019

·

6 min read

# Critical Vulnerability in a New AirSwap Smart Contract (Updated Oct. 3)

 _Our team discovered a critical vulnerability in a new AirSwap smart
contract. Read on to understand the steps we’ve taken to prevent the
vulnerability from being exploited, and to determine whether you need to take
immediate action._

 ** _Updated Oct. 3 with technical details below._**

![](https://miro.medium.com/max/1400/1*oNYolGldAreCOzb8gb6ssA.png)

On September 12th, our internal security review processes identified a
potential exploit in a newly released mainnet AirSwap smart contract. The
vulnerability would allow an attacker, under certain conditions, to perform a
swap without requiring a signature from a counterparty. The affected code was
present in the AirSwap system for under 24 hours, and only affects some users
of AirSwap Instant between midday September 11th and early morning of
September 12th. We initially identified 20 vulnerable addresses matching this
pattern and quickly reduced it to 10 accounts. As of October 3, there are only
5 accounts that remain affected.

When the issue was detected, the team immediately rolled back AirSwap Instant
to use the original smart contracts. Both the AirSwap Instant and Trader
products are no longer affected by the vulnerability.

 **The following accounts used the exploitable functionality during the
vulnerable time period:**

    
    
     0x64ae361c1c55f61a02d2c67a4c78457d5169ac56  
    0x133acc82d6eaaec2a12e7547835219860551c570  
    0x2b13d1463b3821dd8a625e8935ab079251f1376d  
    0x669e01245cc4e8229d8c9cc753a4d14319877122  
    0xbd33caaedf06e436932522a9284d8312f325cae8

 **If your account is not listed, no action is required. If your address is
listed, immediately visit**[
**https://authorizations.airswap.io/**](https://authorizations.airswap.io/)
**to revoke authorizations for the vulnerable contract.** Any new tokens
deposited in the at-risk accounts above remain vulnerable to the exploit, and
are not guaranteed safe, until authorizations are revoked.

# Remediations

The following actions were taken by the AirSwap team immediately after
discovering the vulnerability:

  1.  **High-value user contacts:** Immediately after discovering the vulnerability, the AirSwap team began to enumerate and identify all affected users who had used the vulnerable contract. One user was particularly vulnerable, with the vast majority (95%+) of affected funds. We were able to contact this user, who has provided product feedback in the past, via internal communication channels. This user’s funds were de-risked without alerting the user or other network actors to a potential vulnerability.
  2.  **Modification of the AirSwap system:** All vulnerable components and contracts were removed from the production AirSwap UI and related tools, and new addresses can only be exposed to the vulnerability if a user manually uses the affected, vulnerable contract.
  3.  **Draining of at-risk funds:** After de-risking the above user’s funds, the AirSwap team developed exploit code to proactively drain all vulnerable funds in the AirSwap contracts. If your account was drained by this script, your funds have been placed in a withdrawal contract available only to the account that held the original tokens. More information is below. AirSwap did not and does not currently hold custody of the funds.
  4.  **Monitoring infrastructure:** We are attempting to communicate with the remaining affected users towards the above actions. **Note that this monitoring infrastructure is not a guarantee that funds are safe, as other users could potentially remove funds before our infrastructure detects this.** Therefore, we strongly recommend any affected users immediately apply the above remediations.
  5.  **Public communications:** A public description as well as steps for remediation were released in this blog post. More technical details regarding the exploit will be released after we are confident that the probability of exploitation is low.
  6.  **Evaluating security procedures:** Smart contracts and decentralized finance remain a nascent, adversarial, and complex development environment. At AirSwap, we are strongly committed to providing the maximum possible security to our users. Towards this end, we have multiple internal security processes responsible for continuously reviewing both AirSwap’s overall threat surface and specific AirSwap artifacts for code security. It was one of these internal processes that originally discovered the exploit. Nonetheless, we recognize that our processes are imperfect, and will complete a full internal post-mortem analysis recommending changes to our security and deployment processes. We intend to require stricter standards for funds and authentication flow analysis in future internal reports, creating a rigorous process for evaluating these flows that prevents future authentication bugs. We also intend to weigh the benefits of installing centralized circuit-breakers to halt trading on any affected contracts until maximal confidence is achieved through automated verification or other techniques. We hope these analyses and changes will provide an even greater level of security for our users going forward.

# Conclusion and what’s next

Smart contracts remain an exciting and new arena of software development, and
require continued diligence and analysis to ensure defense against
sophisticated and constantly-evolving attackers. We remain committed to a
continuous security and monitoring process designed to identify
vulnerabilities before they are openly discovered. We would like to deeply
apologize to our affected users for any inconvenience these vulnerabilities
may have caused, and hope that the important lessons we continue to learn
throughout these processes form the basis for a more open, secure, and
efficient trading environment.

# Updated Oct. 3: Technical Details

This update is to provide more technical detail on the vulnerability, having
given at-risk accounts two weeks to take protective actions by [revoking their
authorizations](https://authorizations.airswap.io/).

 **Two important notes:**

  * the new Swap contract only supports swapping ERC20 tokens, not Ether.
  * the Wrapper contract was created so that traders can use their Ether (ETH) for Wrapped Ether (WETH) ERC20 trades.

The specific mechanism is an “authorization” feature that enables one peer to
delegate swapping ability to another peer. In some scenarios, if the maker on
an order has delegated to a peer that sends a transaction, a signature is not
required.

For convenience, the new AirSwap smart contract system includes a “wrapper”
contract that automatically wraps and unwraps ether (ETH) to and from “wrapped
ether” (WETH). To use this feature, the user authorizes the Wrapper contract
to swap on its behalf.

The vulnerability is an example of a flaw in authentication flows, believed to
be [the most common type of security
vulnerability](https://blog.trailofbits.com/2019/08/08/246-findings-from-our-
smart-contract-audits-an-executive-summary/) in production smart contracts
today. Our team performed an internal security assessment to define
invariants, write tests with full statement and branch coverage, and consider
every possible angle of attack or disruption. Even with this, it was not until
after deployment that this vulnerability was discovered.

The Wrapper contract now both requires that the message sender is the order
taker, and that the order has a signature, which is then verified by the Swap
contract.

## Normal trading scenario

Under normal circumstances, every order requires a signature. In this
sequence, Alice and Bob would both authorize the Wrapper on the Swap contract.
Bob would then request an order from Alice and execute it through the Wrapper.
An order with Alice’s signature would be returned to Bob. Bob would then
provide the order to the Wrapper to swap. The signature would be deemed valid
and the swap would complete.

## Compromised trading scenario

In the compromised scenario, Bob does not need to request an order from Alice.
Instead, Bob creates an order with Alice as the maker but without a signature.
When Bob provides the order to the Wrapper, the swap will complete, because
Alice has also authorized the Wrapper.

Alice is the victim, and Bob is the attacker.

  1. Alice wants to use AirSwap Instant.
  2. Alice Authorizes the Wrapper contract on the Swap contract.
  3. Bob sees that Alice has authorized the Wrapper.
  4. Bob constructs an order with Alice as the maker and Bob as the taker without a signature, and sends it to the Wrapper.
  5. The Wrapper does not require a signature. Because Alice has authorized the Wrapper, the Swap contract does not require a signature.
  6. The trade completes without Alice’s involvement and her funds are gone.

Due to the nature of the vulnerability Bob can monitor Alice’s wallet and
drain funds at any time. This vulnerability is permanent until the Wrapper
authorization is revoked. We implore any of the remaining at-risk accounts
above to [revoke your authorization](https://authorizations.airswap.io/).

# Future updates

We are constantly monitoring the remaining accounts and will update this post
with further details if they emerge. If you discover any potential issues
going forward please reach us at
[bounty@airswap.io](mailto:bounty@airswap.io).

# About AirSwap

AirSwap enables peer-to-peer trading on the Ethereum blockchain. Built on a
decentralized protocol, traders can add or remove liquidity through a suite of
trustless products that are easy to use and free. Our mission is to empower
the world with frictionless trade.

[Blog](https://medium.com/fluidity) | [Twitter](https://twitter.com/airswap) |
[Discord](https://chat.airswap.io/) | [Developers](https://docs.airswap.io/) |
[Makers](https://makers.airswap.io/) |
[Reddit](https://www.reddit.com/r/airswap) |
[Facebook](https://www.facebook.com/airswapio/) |
[Linkedin](http://www.linkedin.com/company/airswap/) |
[Subscribe](https://upscri.be/b0fed8-2) |
[Support](https://support.airswap.io/) | [Request a
Feature](https://airswap.canny.io/) | [FAQ](https://support.airswap.io/faq) |
[Trade Now](https://instant.airswap.io/)

\--

2

\--

\--

2

## [More from Fluidity](/fluidity?source=post_page-----
c1204e04d7d3--------------------------------)

Rebuilding Finance for a Frictionless World

[Read more from Fluidity](/fluidity?source=post_page-----
c1204e04d7d3--------------------------------)

## Recommended from Medium

[[![Quecko
Inc](https://miro.medium.com/fit/c/40/40/1*J-lvmBW00eDgVLxQEYXqoQ.png)](/@queckoinc?source=post_internal_links
---------0----------------------------)

[Quecko Inc

](/@queckoinc?source=post_internal_links---------
0----------------------------)

## Blockchain-enabled Internet of Things: Decentralization and Security
Concerns

![](https://miro.medium.com/focal/112/112/50/50/1*6L5_glQAQkHSS3OCWEFImA.jpeg)](/@queckoinc/blockchain-
enabled-internet-of-things-decentralization-and-security-
concerns-b044c6e2f0f2?source=post_internal_links---------
0----------------------------)

[[![denglad](https://miro.medium.com/fit/c/40/40/0*3FdOLF5oAaWF9Rs5)](/@denglad?source=post_internal_links
---------1----------------------------)

[denglad

](/@denglad?source=post_internal_links---------1----------------------------)

## How to Recover a TrueCrypt Password in Windows? (this is my password)

![](https://miro.medium.com/focal/112/112/50/50/0*GC4NJnKpUjs3AQbO.jpg)](/@denglad/how-
to-recover-a-truecrypt-password-in-windows-this-is-my-
password-2761774fe42f?source=post_internal_links---------
1----------------------------)

[[![Yang
Cheung](https://miro.medium.com/fit/c/40/40/0*nGd9_GMiMry2uWQx)](/@yang.hou.cheung?source=post_internal_links
---------2----------------------------)

[Yang Cheung

](/@yang.hou.cheung?source=post_internal_links---------
2----------------------------)

in

[One Creation

](https://medium.com/one-creation?source=post_internal_links---------
2----------------------------)

## DePri: Consent Management for Open Banking

![](https://miro.medium.com/focal/112/112/50/50/1*-x73yfi16oZSbZ8irO05VQ.png)](/one-
creation/depri-consent-management-for-open-
banking-c79a453f721c?source=post_internal_links---------
2----------------------------)

[[![Worldtransfercrypto](https://miro.medium.com/fit/c/40/40/0*l8WGcrMMEBnuk3ac)](/@worldtransfercrypto?source=post_internal_links
---------3----------------------------)

[Worldtransfercrypto

](/@worldtransfercrypto?source=post_internal_links---------
3----------------------------)

## The #WorldTransferCryptoCreditNetwork team is ready to present an airdrop
to our community!

![](https://miro.medium.com/focal/112/112/50/50/1*wnWJXJcAQTYu6MU15RAZmQ.jpeg)](/@worldtransfercrypto/the-
worldtransfercryptocreditnetwork-team-is-ready-to-present-an-airdrop-to-our-
community-9601c2dd8b15?source=post_internal_links---------
3----------------------------)

[[![BONK
DAO](https://miro.medium.com/fit/c/40/40/1*_uvEIfu4TcIBcGrmg3VRvA.png)](/@BonkDao?source=post_internal_links
---------4----------------------------)

[BONK DAO

](/@BonkDao?source=post_internal_links---------4----------------------------)

## Let’s Cheer To The Era Of $BONK

![](https://miro.medium.com/focal/112/112/50/50/1*loTgyKpXjDBD-T6FTaJtlQ.jpeg)](/@BonkDao/lets-
cheer-to-the-era-of-bonk-d4383b2a1b43?source=post_internal_links---------
4----------------------------)

[[![Noel
Marna](https://miro.medium.com/fit/c/40/40/1*dmbNkD5D-u45r44go_cf0g.png)](/@interossei1912?source=post_internal_links
---------5----------------------------)

[Noel Marna

](/@interossei1912?source=post_internal_links---------
5----------------------------)

## {UPDATE} Country Hills Ear Doctor Hack Free Resources Generator

](/@interossei1912/update-country-hills-ear-doctor-hack-free-resources-
generator-16dc0dcc90c2?source=post_internal_links---------
5----------------------------)

[[![KardiaChain](https://miro.medium.com/fit/c/40/40/1*EWhyoMxCnHlefQ9sRdipPg.png)](/@kardiachain?source=post_internal_links
---------6----------------------------)

[KardiaChain

](/@kardiachain?source=post_internal_links---------
6----------------------------)

## KuCoin Announces to Support the KardiaChain (KAI) MainNet Token Swap

![](https://miro.medium.com/focal/112/112/50/50/1*BaiKZdmGuxJaqzKdtrg5NA.png)](/@kardiachain/kucoin-
announces-to-support-the-kardiachain-kai-mainnet-token-
swap-4121a7baac9a?source=post_internal_links---------
6----------------------------)

[[![Deon Christie
\(DCMarketing\)](https://miro.medium.com/fit/c/40/40/1*hJaTeHREL84TyQ4jQw0oQw.png)](/@deonchristie?source=post_internal_links
---------7----------------------------)

[Deon Christie (DCMarketing)

](/@deonchristie?source=post_internal_links---------
7----------------------------)

## How to Identify and Avoid Email Scams or Scam Websites Before Losing Money!

![](https://miro.medium.com/focal/112/112/50/50/1*w9LEImJexnIWrVUp2pFiRQ.png)](/@deonchristie/how-
to-identify-and-avoid-email-scams-or-scam-websites-before-losing-money-
ed1dfd48f2fc?source=post_internal_links---------7----------------------------)

[](/?source=post_page-----c1204e04d7d3--------------------------------)

[About](https://medium.com/about?autoplay=1&source=post_page-----
c1204e04d7d3--------------------------------)[Help](https://help.medium.com/hc/en-
us?source=post_page-----
c1204e04d7d3--------------------------------)[Terms](https://policy.medium.com/medium-
terms-of-service-9db0094a1e0f?source=post_page-----
c1204e04d7d3--------------------------------)[Privacy](https://policy.medium.com/medium-
privacy-policy-f03bf92035c9?source=post_page-----
c1204e04d7d3--------------------------------)

* * *

## Get the Medium app

[![A button that says 'Download on the App Store', and if clicked it will lead
you to the iOS App
store](https://miro.medium.com/max/270/1*Crl55Tm6yDNMoucPo1tvDg.png)](https://itunes.apple.com/app/medium-
everyones-stories/id828256236?pt=698524&mt=8&ct=post_page&source=post_page
-----c1204e04d7d3--------------------------------)

[![A button that says 'Get it on, Google Play', and if clicked it will lead
you to the Google Play
store](https://miro.medium.com/max/270/1*W_RAPQ62h0em559zluJLdQ.png)](https://play.google.com/store/apps/details?id=com.medium.reader&source=post_page
-----c1204e04d7d3--------------------------------)

[Get
started](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Ffluidity%2Fcritical-
vulnerability-in-a-new-airswap-smart-contract-c1204e04d7d3&source=post_page
--------------------------nav_reg-----------)

[![AirSwap](https://miro.medium.com/fit/c/176/176/1*S-j0-sWqnj2pMlbQUFV4iQ.jpeg)](/@airswap)

[

## AirSwap

](/@airswap)

2.8K Followers

AirSwap is a developer community focused on decentralized trading systems.

Follow

[](/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F198e2de34d43&operation=register&redirect=https%3A%2F%2Fmedium.com%2Ffluidity%2Fcritical-
vulnerability-in-a-new-airswap-smart-
contract-c1204e04d7d3&newsletterV3=b501917dd00d&newsletterV3Id=198e2de34d43&user=AirSwap&userId=b501917dd00d&source=--------------------------subscribe_user-----------)

## More from Medium

[[![Mark
Mathis](https://miro.medium.com/fit/c/40/40/1*GwGIgHi9ngu0bsSrr_v79g.png)](/@cipherz?source=read_next_recirc
---------0---------------------49b6e72f_7626_46c7_b865_4459be3105cb-------)

[Mark Mathis

](/@cipherz?source=read_next_recirc---------0---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

## Production Contract Security — Part 2

![](https://miro.medium.com/focal/112/112/50/50/1*jJJQY1PsW1u-k1xkaI5qLA.png)](/@cipherz/production-
contract-security-part-2-b631a67b6b4e?source=read_next_recirc---------0
---------------------49b6e72f_7626_46c7_b865_4459be3105cb-------)

[[![Zoumana
Cisse](https://miro.medium.com/fit/c/40/40/1*6IxBVXBYLv_ZJl346aJ9ow@2x.jpeg)](/@zouvier?source=read_next_recirc
---------1---------------------49b6e72f_7626_46c7_b865_4459be3105cb-------)

[Zoumana Cisse

](/@zouvier?source=read_next_recirc---------1---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

in

[Block Magnates

](https://medium.com/block-magnates?source=read_next_recirc---------1
---------------------49b6e72f_7626_46c7_b865_4459be3105cb-------)

## Beating Ethernaut: level 2 Fallout

![](https://miro.medium.com/focal/112/112/73/50/0*efbQPm-
mVUIdhxYo.jpg)](/block-magnates/beating-ethernaut-
level-2-aef0d14ef5a0?source=read_next_recirc---------1---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

[[![lunaray](https://miro.medium.com/fit/c/40/40/1*1iVrJ2nXW4V5zN16PS-
OpQ.png)](/@lunaray?source=read_next_recirc---------2---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

[lunaray

](/@lunaray?source=read_next_recirc---------2---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

## Lunaray Token Security Scan Report

![](https://miro.medium.com/focal/112/112/50/50/1*G5RUxpQq-
Rn9dlo3cidfZw.png)](/@lunaray/lunaray-token-security-scan-
report-7e0a70d800fd?source=read_next_recirc---------2---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

[[![M-Zohaib Nasir](https://miro.medium.com/fit/c/40/40/1*yFrYQthUU-xQa_-
SG1Z1Ig.jpeg)](/@inthediary?source=read_next_recirc---------3
---------------------49b6e72f_7626_46c7_b865_4459be3105cb-------)

[M-Zohaib Nasir

](/@inthediary?source=read_next_recirc---------3---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

## Brownie 101- New Project

![](https://miro.medium.com/focal/112/112/50/50/1*bQF2YgkbYJRM3H9U3LAv-w.png)](/@inthediary/brownie-101-new-
project-b53d58467b60?source=read_next_recirc---------3---------------------
49b6e72f_7626_46c7_b865_4459be3105cb-------)

[Help

](https://help.medium.com/hc/en-us)

[Status

](https://medium.statuspage.io)

[Writers

](https://about.medium.com/creators/)

[Blog

](https://blog.medium.com)

[Careers

](/jobs-at-medium/work-at-medium-959d1a85284e)

[Privacy

](https://policy.medium.com/medium-privacy-policy-f03bf92035c9)

[Terms

](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f)

[About

](https://medium.com/about?autoplay=1)

[Knowable

](https://knowable.fyi)

